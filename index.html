<!DOCTYPE html>
<html>
<head>
    <title>Weather Loop</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        img { width: 100%; height: 100%; object-fit: contain; }
        #loading { position: absolute; color: white; font-family: sans-serif; bottom: 20px; right: 20px; }
    </style>
</head>
<body>
    <img id="satImage" src="" alt="Satellite View" />
    <div id="loading">Updating...</div>

    <script>
        // CONFIGURATION
        const SATELLITE = "GOES16"; // Try GOES19 if this is black (East Coast) or GOES18 (West Coast)
        const SECTOR = "CONUS";     // "CONUS" (USA) or "FD" (Full Disk)
        const BAND = "GeoColor";    // "GeoColor", "Band13" (IR), etc.
        const RES = "1250x750";     // Resolution: "2500x1500" (4K) or "1250x750" (HD)
        
        // LOGIC
        let images = [];
        let currentIndex = 0;
        const imgElement = document.getElementById("satImage");
        const loadingElement = document.getElementById("loading");

        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        function generateUrl(date) {
            // NOAA Format: YYYYDDDHHMM_GOES16-ABI-CONUS-GeoColor-1250x750.jpg
            const year = date.getUTCFullYear();
            const day = getDayOfYear(date).toString().padStart(3, '0');
            const hour = date.getUTCHours().toString().padStart(2, '0');
            const min = date.getUTCMinutes().toString().padStart(2, '0');
            
            return `https://cdn.star.nesdis.noaa.gov/${SATELLITE}/ABI/${SECTOR}/${BAND}/${year}${day}${hour}${min}_${SATELLITE}-ABI-${SECTOR}-${BAND}-${RES}.jpg`;
        }

        function loadLoop() {
            const now = new Date();
            // Round down to nearest 5 minutes (NOAA update frequency)
            let startCoeff = 1000 * 60 * 5;
            let roundedNow = new Date(Math.floor(now.getTime() / startCoeff) * startCoeff);

            // Generate last 24 frames (2 hours)
            let urls = [];
            for (let i = 24; i >= 0; i--) {
                let d = new Date(roundedNow.getTime() - (i * 5 * 60000));
                urls.push(generateUrl(d));
            }
            
            // Preload images
            let loadedCount = 0;
            images = []; // Clear old list
            
            urls.forEach(url => {
                const img = new Image();
                img.onload = () => {
                    loadedCount++;
                    if(loadedCount > 10) loadingElement.style.display = 'none'; // Hide text once we have data
                };
                img.onerror = () => { /* Skip missing frames */ };
                img.src = url;
                images.push(img);
            });
        }

        // Animation Loop
        setInterval(() => {
            if (images.length > 0) {
                // Find next valid image in our list
                let loopCount = 0;
                while (loopCount < images.length) {
                    currentIndex = (currentIndex + 1) % images.length;
                    if (images[currentIndex].complete && images[currentIndex].naturalHeight !== 0) {
                        imgElement.src = images[currentIndex].src;
                        break;
                    }
                    loopCount++;
                }
            }
        }, 200); // Speed: 200ms per frame

        // Refresh data every 10 minutes
        loadLoop();
        setInterval(loadLoop, 600000); 
    </script>
</body>
</html>